(()=>{(function(){"use strict";if(window.__pt_sdk_loaded){console.warn("[PrimeTracker] SDK already loaded, skipping initialization");return}window.__pt_sdk_loaded=!0;let le="0.2.3",Z="_ptq",w={ANON_ID:"__pt_anonymous_id",USER_ID:"__pt_user_id",SESSION_ID:"__pt_session_id",SESSION_LAST:"__pt_session_last",FIRST_REF:"__pt_first_referrer"},ue=30*60*1e3,J=200,de=5e3,fe=[25,50,75,100],Y=120,c={...{collectUrl:null,debug:!1,trackPageViews:!0,trackClicks:!0,trackScroll:!0,trackErrors:!0,trackCards:!0,consentAnalytics:!0,sampleRate:1,includeQueryHash:!1,useBeaconOnUnload:!0,plugins:{search:!1,ads:!1},search:{minEmitMs:350,maxWaitMs:4500,quietDebounceMs:220,recheckIntervalMs:300,firstFallbackMs:2200,scopeSelector:"main",resultItemSelector:"article,[data-article-id],[data-content-id],[data-result],.search-result,.result,[data-testid*='result']",adExcludeSelector:"[data-ad-id],[data-ad-slot],[data-ad-provider],[role='advertisement'],iframe"},ads:{threshold:.5,minVisibleMs:300,minViewableMs:1e3,rescanIntervalMs:2e3,rescanTicks:15,containerSelector:"[data-ad-id],[data-ad-slot],[data-ad-provider],[role='advertisement'],iframe",dataSelector:"[data-ad-id],[data-ad-slot],[data-ad-provider]"},cards:{threshold:.5,minVisibleMs:300}}},A={project_id:null,cdnBase:null,tagVersion:null},n={anonymous_id:null,session_id:null,user_id:null,consent:{analytics:!0},sampled:!0,sampleSeed:null,currentUrl:null,previousUrl:null,entryReferrer:null,eventBuffer:[],scrollFired:new Set,scrollMaxDepth:0,webVitals:{LCP:0,INP:0,CLS:0,TTFB:0,FCP:0,FID:0},lastSearchQuery:null,lastSearchResultsCount:null,lastSearchLatencyMs:null,pendingSearchToken:null,pendingSearchStartTs:null,pendingSearchElementId:null,pendingSearchQuery:null,pendingSearchDebounceTimer:null,pendingSearchEmitTimer:null,pageStartTs:Date.now()};function N(){return Date.now()}function F(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function O(e){return!e||typeof e!="string"||(e=e.replace(/\s+/g," ").trim(),!e)?null:(e.length>Y&&(e=e.slice(0,Y)+"\u2026"),e=e.replace(/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/gi,"[redacted_email]"),e=e.replace(/\+?\d[\d\s\-()]{7,}\d/g,"[redacted_phone]"),e)}function Q(e){try{return localStorage.getItem(e)}catch{return null}}function V(e,t){try{localStorage.setItem(e,t)}catch{}}function me(e){try{localStorage.removeItem(e)}catch{}}function ee(e){try{return sessionStorage.getItem(e)}catch{return null}}function te(e,t){try{sessionStorage.setItem(e,t)}catch{}}function v(...e){c.debug&&console.log("[PrimeTracker]",...e)}function he(){let e=Q(w.ANON_ID);return e||(e=F(),V(w.ANON_ID,e)),e}function ge(){try{let e=N(),t=Number(ee(w.SESSION_LAST)||"0"),r=ee(w.SESSION_ID);return(!r||!t||e-t>ue)&&(r=F(),te(w.SESSION_ID,r)),te(w.SESSION_LAST,String(e)),r}catch{return F()}}function pe(){if(n.user_id)return n.user_id;let e=Q(w.USER_ID);return n.user_id=e?String(e):null,n.user_id}function Se(e){if(e==null||e===""){n.user_id=null,me(w.USER_ID),v("User ID cleared");return}n.user_id=String(e),V(w.USER_ID,n.user_id),v("User ID set:",n.user_id)}function _e(){let e=Q(w.FIRST_REF);if(e)return e;try{let r=new URL(location.href),s=r.searchParams.get("utm_source"),l=r.searchParams.get("utm_medium"),o=r.searchParams.get("utm_campaign");if(s||l||o){let a=`utm:${s||"?"}/${l||"?"}/${o||"?"}`;return V(w.FIRST_REF,a),a}}catch{}let t=document.referrer;return t&&t.trim()?(V(w.FIRST_REF,t),t):(V(w.FIRST_REF,"direct"),"direct")}function M(){if(c.includeQueryHash)return window.location.href;try{let e=new URL(window.location.href);return e.search="",e.hash="",e.toString()}catch{return window.location.href}}function ve(){return{user_agent:navigator.userAgent,language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,screen_width:window.screen.width,screen_height:window.screen.height,screen_dpr:window.devicePixelRatio||1,viewport_width:window.innerWidth,viewport_height:window.innerHeight,sdk_version:le,tag_version:A.tagVersion||null}}function E(e,t={},r={}){let s=M();return{project_id:A.project_id,event_name:e,event_ts:new Date().toISOString(),anonymous_id:n.anonymous_id,session_id:n.session_id,user_id:n.user_id,page_url:s,page_path:window.location.pathname,page_title:document.title,referrer:n.entryReferrer||document.referrer||null,previous_url:n.previousUrl,context:ve(),properties:t,web_vitals:{...n.webVitals,...r}}}function re(){return n.sampled&&n.consent.analytics!==!1&&!!A.project_id&&!!c.collectUrl}function T(e){if(!re()){v("Event blocked:",e.event_name,"sampled:",n.sampled,"consent:",n.consent.analytics);return}n.eventBuffer.push(e),c.debug&&console.log("%c[PT] Event queued","color: #4CAF50; font-weight: bold",e.event_name,e),n.eventBuffer.length>=20?B({reason:"size"}):be()}let z=null;function be(){z||(z=setTimeout(()=>{z=null,B({reason:"timer"})},de))}function ye(){let e=c.collectUrl;if(!e)return null;let t=A.project_id;if(!t)return e;try{let r=new URL(e,window.location.href);return r.searchParams.get("siteId")||r.searchParams.set("siteId",t),r.toString()}catch{return/([?&])siteId=/.test(e)?e:e+(e.includes("?")?"&":"?")+"siteId="+encodeURIComponent(t)}}function B({reason:e,useBeacon:t=!1}={}){if(!n.eventBuffer.length||!re())return;let r=n.eventBuffer.splice(0,n.eventBuffer.length),s=[];for(let a=0;a<r.length;a+=J)s.push(r.slice(a,a+J));let l=c.useBeaconOnUnload&&(e==="pagehide"||e==="hidden"),o=ye();if(!o){v("No collectUrl, cannot flush");return}v(`Flushing ${r.length} events (reason: ${e}, beacon: ${l})`),s.forEach(a=>{let d={project_id:A.project_id,sent_at:new Date().toISOString(),events:a};if(l&&navigator.sendBeacon)try{let f=new Blob([JSON.stringify(d)],{type:"application/json"}),p=navigator.sendBeacon(o,f);v("Beacon sent:",p,a.length,"events");return}catch(f){v("Beacon failed, using fetch:",f)}fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),keepalive:!0}).then(async f=>{if(f.ok)v("Collect success:",f.status,a.length,"events");else{let p=await f.text().catch(()=>"");v("Collect error:",f.status,p)}}).catch(f=>v("Collect failed:",f))})}function ne(){(n.sampleSeed===null||n.sampleSeed===void 0)&&(n.sampleSeed=Math.random());let e=typeof c.sampleRate=="number"?c.sampleRate:1,t=Math.max(0,Math.min(1,e));n.sampled=n.sampleSeed<t,v("Sampling:",{seed:n.sampleSeed,rate:t,sampled:n.sampled})}function we(e){if(!e||!e.tagName)return null;let t=[],r=e;for(let s=0;s<4&&r&&r.tagName;s++){let l=r.tagName.toLowerCase();if(r.id){l+=`#${r.id}`,t.unshift(l);break}r.classList&&r.classList.length&&(l+="."+Array.from(r.classList).slice(0,2).join(".")),t.unshift(l),r=r.parentElement}return t.join(">")}function Ee(e){try{let t=2166136261;for(let r=0;r<e.length;r++)t^=e.charCodeAt(r),t=t+((t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24))>>>0;return t.toString(36)}catch{return String(Math.floor(Math.random()*1e9)).toString(36)}}function R(e){if(!e)return null;let t=e.closest?.("[data-elt]")||e,r=t.getAttribute?.("data-elt")||t.getAttribute?.("data-testid")||t.getAttribute?.("id")||t.getAttribute?.("aria-label")||null;if(r&&String(r).trim())return String(r).trim();let s=we(t);return s?`e_${Ee(s)}`:null}function Te(e){if(!c.trackClicks)return;let t=e.target,r=t.closest?.("a,button,input,textarea,select,[role='button'],[role='link'],[data-elt]")||t,s=R(r),l=(r?.tagName||"").toLowerCase()||null,o=r?.getAttribute?.("role")||r?.getAttribute?.("data-role")||null,a={element_id:s,element_type:l,element_role:o,text:O(r?.innerText),href:r?.href||null,x:e.clientX,y:e.clientY,button:e.button};T(E("click",a))}function ke(){let e=document.documentElement,t=e.scrollTop||document.body.scrollTop||0,r=e.scrollHeight||document.body.scrollHeight||0,s=e.clientHeight||1;return Math.max(0,Math.min(100,t/Math.max(1,r-s)*100))}function Ie(){if(!c.trackScroll)return;let e=ke();e>n.scrollMaxDepth&&(n.scrollMaxDepth=e);for(let t of fe)e>=t&&!n.scrollFired.has(t)&&(n.scrollFired.add(t),T(E("scroll",{element_id:"page",scroll_depth:t})))}function Ce(){if(!c.trackErrors)return;let e=new Set,t=o=>{try{let a=JSON.stringify(o);return a.length>800?a.slice(0,800):a}catch{return String(o)}},r=o=>{try{if(o==null)return null;let a=String(o).trim();return a?(a.length>500&&(a=a.slice(0,500)+"\u2026"),a):null}catch{return null}},s=(o,a)=>{try{let d=o||a?.fileName||a?.sourceURL||a?.scriptURL||null;if(d)return d;let f=String(a?.stack||"");if(!f)return null;let p=f.match(/(https?:\/\/[^\s)]+|file:\/\/[^\s)]+)/i);if(p&&p[1])return p[1];let i=f.match(/(\b\/[^\s)]+):\d+:\d+/);return i&&i[1]?i[1]:null}catch{return null}},l=o=>{let a=t(o);e.has(a)||(e.add(a),T(E("error",o)))};window.addEventListener("error",o=>{try{if(!o.message&&(o.target||o.srcElement)){let p=o.target||o.srcElement,i=p?.currentSrc||p?.src||p?.href||p?.getAttribute?.("src")||p?.getAttribute?.("href")||null,u=r(i);l({error_type:"resource",message:"resource_load_error",source_url:u,resource_url:u,resource_tag:(p?.tagName||"").toLowerCase()||null,element_id:R(p)||null,is_fatal:!1});return}let d=O(o?.message)||"js_error",f=r(s(o?.filename,o?.error))||r(o?.filename)||null;l({error_type:"js",message:d,filename:o?.filename||null,lineno:o?.lineno||null,colno:o?.colno||null,source_url:f,stack:O(o?.error?.stack),is_fatal:!1})}catch{l({error_type:"js",message:"js_error",source_url:null,is_fatal:!1})}},!0),window.addEventListener("unhandledrejection",o=>{try{let a=o?.reason?.message||String(o?.reason||""),d=O(a)||"unhandled_promise",f=r(s(null,o?.reason))||null;l({error_type:"unhandledrejection",message:d,source_url:f,stack:O(o?.reason?.stack),is_fatal:!1})}catch{l({error_type:"unhandledrejection",message:"unhandled_promise",source_url:null,is_fatal:!1})}})}function xe(){try{let e=performance.getEntriesByType("navigation")[0];if(e&&e.responseStart&&(n.webVitals.TTFB=Math.round(e.responseStart)),window.PerformanceObserver){new PerformanceObserver(a=>{a.getEntries().forEach(d=>{d.name==="first-contentful-paint"&&(n.webVitals.FCP=Math.round(d.startTime))})}).observe({type:"paint",buffered:!0}),new PerformanceObserver(a=>{let d=a.getEntries(),f=d[d.length-1];f&&(n.webVitals.LCP=Math.round(f.startTime))}).observe({type:"largest-contentful-paint",buffered:!0});let s=0;new PerformanceObserver(a=>{a.getEntries().forEach(d=>{d.hadRecentInput||(s+=d.value)}),n.webVitals.CLS=Number(s.toFixed(4))}).observe({type:"layout-shift",buffered:!0}),new PerformanceObserver(a=>{let d=a.getEntries()[0];d&&(n.webVitals.FID=Math.round(d.processingStart-d.startTime))}).observe({type:"first-input",buffered:!0});try{new PerformanceObserver(d=>{d.getEntries().forEach(f=>{f.duration>n.webVitals.INP&&(n.webVitals.INP=Math.round(f.duration))})}).observe({type:"event",buffered:!0,durationThreshold:40})}catch{}}}catch(e){v("Web vitals init error:",e)}}function ie(e="initial"){c.trackPageViews&&(T(E("page_view",{trigger:e,url:M(),path:window.location.pathname,title:document.title})),n.currentUrl=M())}function q(e,t="manual"){let r=e||M(),s=n.currentUrl||null;n.scrollFired.clear(),n.previousUrl=s,n.currentUrl=r,T(E("route",{kind:t,from:s,to:r})),c.trackPageViews&&ie(t)}function Ae(){let e=history.pushState,t=history.replaceState;history.pushState=function(...r){let s=n.currentUrl||M(),l=e.apply(this,r);return setTimeout(()=>q(null,"pushState"),0),l},history.replaceState=function(...r){let s=n.currentUrl||M(),l=t.apply(this,r);return setTimeout(()=>q(null,"replaceState"),0),l},window.addEventListener("popstate",()=>{setTimeout(()=>q(null,"popstate"),0)}),window.addEventListener("hashchange",()=>{setTimeout(()=>q(null,"hashchange"),0)})}function ae(){v("Page hiding, flushing events"),B({reason:"pagehide",useBeacon:!0})}function Le(){document.visibilityState==="hidden"&&B({reason:"hidden",useBeacon:!0})}function U(e){return e?!!(e.closest?.("[data-ad-id],[data-ad-slot],[data-ad-provider],[role='advertisement']")||e.tagName?.toLowerCase()==="iframe"&&/doubleclick|googlesyndication|adservice/i.test(e.getAttribute("src")||"")):!1}function W(e){if(!e||U(e))return!1;let t=(e.tagName||"").toLowerCase(),r=(e.className||"").toString().toLowerCase(),s=(e.getAttribute?.("data-testid")||"").toLowerCase(),l=!!(e.getAttribute?.("data-article-id")||e.getAttribute?.("data-content-id")),o=/(card|story|post|tile|teaser|item|result|entry)/i.test(r),a=/(card|story|tile|teaser|result)/i.test(s),d=!!e.querySelector?.("img, picture, video"),f=!!e.querySelector?.("h1,h2,h3"),p=!!e.querySelector?.("a[href]")||t==="a";return!!(t==="article"||l||(o||a)&&(d||f)&&p)}function j(e,t=120,r=80){try{let s=e.getBoundingClientRect?.();return s&&s.width>=t&&s.height>=r}catch{return!1}}function $(e){if(!e)return null;let t=e.closest?.("article,[data-article-id],[data-content-id],[data-elt]")||e;if(t&&W(t)&&j(t))return t;let r=e;for(let s=0;s<6&&r;s++){if(r.nodeType!==1){r=r.parentElement;continue}if(W(r)&&j(r))return r;r=r.parentElement}return null}function G(e){return e&&(e.getAttribute?.("data-article-id")||e.getAttribute?.("data-content-id")||e.querySelector?.("[data-article-id]")?.getAttribute?.("data-article-id")||e.querySelector?.("[data-content-id]")?.getAttribute?.("data-content-id"))||null}function K(e){if(!e)return null;try{let t=e?.parentElement;if(!t)return null;let s=Array.from(t.children).indexOf(e);return s>=0?s+1:null}catch{return null}}function Me(){if(!c.trackCards)return;let e=new Set,t=new WeakMap,r=()=>{document.querySelectorAll("article, a[href], [data-article-id], [data-content-id], [data-elt]").forEach(o=>{if(e.size>900||U(o))return;let a=$(o);!a||!j(a)||e.add(a)})};r();let s=new IntersectionObserver(o=>{for(let a of o){let d=a.target;if(!d||U(d)||!W(d))continue;let f=a.intersectionRatio||0,p=a.isIntersecting&&f>=(c.cards.threshold||.5),i=t.get(d);i||(i={timer:null,sent:!1,impression_id:F(),lastRatio:0},t.set(d,i)),i.lastRatio=f,p&&!i.sent&&!i.timer&&(i.timer=setTimeout(()=>{i.sent=!0,i.timer=null;let u=G(d),m=R(d);T(E("card_impression",{element_id:m,card_id:m,article_id:u,slot_position:K(d),viewport_percent:Math.round(i.lastRatio*100),impression_id:i.impression_id}))},c.cards.minVisibleMs||300)),!p&&i.timer&&(clearTimeout(i.timer),i.timer=null)}},{threshold:[c.cards.threshold||.5]});e.forEach(o=>{try{s.observe(o)}catch{}}),new MutationObserver(()=>{r(),e.forEach(o=>{try{s.observe(o)}catch{}})}).observe(document.documentElement,{childList:!0,subtree:!0})}function Re(){c.trackCards&&document.addEventListener("click",e=>{let t=e.target,r=$(t);if(!r||U(r))return;let s=G(r),l=R(r);T(E("card_click",{element_id:l,card_id:l,article_id:s,slot_position:K(r)}))},!0)}function Ue(){let e=null;function t(){return!!c.plugins.search}function r(i){let u=(i?.tagName||"").toLowerCase();if(u!=="input"&&u!=="textarea")return!1;let m=(i.getAttribute?.("type")||"").toLowerCase(),_=i.getAttribute?.("role")||"",k=i.getAttribute?.("name")||"",x=i.getAttribute?.("placeholder")||"";return _==="searchbox"||m==="search"||/search/i.test(k)||/search/i.test(x)}function s(i){try{if(!i||i.hidden)return!1;let u=window.getComputedStyle?getComputedStyle(i):null;if(u&&(u.display==="none"||u.visibility==="hidden"||u.opacity==="0"))return!1;let m=i.getBoundingClientRect?.();return m&&m.width>0&&m.height>0}catch{return!0}}function l(){try{let i=c.search||{},u=document.querySelector(i.scopeSelector||"main")||document.body,m=i.resultItemSelector||"article,[data-article-id],[data-content-id]",_=i.adExcludeSelector||"[data-ad-id],[role='advertisement'],iframe",k=Array.from(u.querySelectorAll(m)),x=0;for(let L of k){if(!s(L)||L.closest?.("header,nav,footer")||_&&(L.matches?.(_)||L.closest?.(_))||U(L))continue;let P=L.getBoundingClientRect?.();P&&(P.width<80||P.height<40)||x++}return x}catch{return 0}}function o(i=!1){if(!n.pendingSearchToken||!n.pendingSearchStartTs)return!1;let u=Math.max(0,N()-n.pendingSearchStartTs),m=l(),_=c.search||{};return i||m>0&&u>=(_.minEmitMs||350)||u>=(_.maxWaitMs||4500)?(n.lastSearchResultsCount=m,n.lastSearchLatencyMs=Math.round(u),T(E("search",{element_id:n.pendingSearchElementId||"search_input",query:n.pendingSearchQuery||n.lastSearchQuery||"",results_count:m,search_latency_ms:Math.round(u)})),n.pendingSearchToken=null,n.pendingSearchStartTs=null,n.pendingSearchElementId=null,n.pendingSearchQuery=null,n.pendingSearchEmitTimer&&(clearTimeout(n.pendingSearchEmitTimer),n.pendingSearchEmitTimer=null),n.pendingSearchDebounceTimer&&(clearTimeout(n.pendingSearchDebounceTimer),n.pendingSearchDebounceTimer=null),!0):!1}function a(){if(!e)try{let i=document.querySelector(c.search?.scopeSelector||"main")||document.body;e=new MutationObserver(()=>{!n.pendingSearchToken||!n.pendingSearchStartTs||(n.pendingSearchDebounceTimer&&clearTimeout(n.pendingSearchDebounceTimer),n.pendingSearchDebounceTimer=setTimeout(()=>{o(!1)},c.search?.quietDebounceMs||220))}),e.observe(i,{childList:!0,subtree:!0,attributes:!0})}catch{}}function d(i){if(!t())return;let u=O(i?.value)||"";if(!u)return;n.lastSearchQuery=u,n.pendingSearchToken=F(),n.pendingSearchStartTs=N(),n.pendingSearchElementId=R(i)||"search_input",n.pendingSearchQuery=u,n.pendingSearchEmitTimer&&clearTimeout(n.pendingSearchEmitTimer),n.pendingSearchDebounceTimer&&clearTimeout(n.pendingSearchDebounceTimer),a();let m=()=>{if(!n.pendingSearchToken||!n.pendingSearchStartTs)return;let _=N()-n.pendingSearchStartTs,k=c.search?.maxWaitMs||4500;if(!o(!1)){if(_>=k){o(!0);return}n.pendingSearchEmitTimer=setTimeout(m,c.search?.recheckIntervalMs||300)}};n.pendingSearchEmitTimer=setTimeout(m,c.search?.firstFallbackMs||2200)}function f(i){try{let u=i?.closest?.("form");if(u){let m=Array.from(u.querySelectorAll("input,textarea")).find(r);if(m)return m}return Array.from(document.querySelectorAll("input,textarea")).find(r)||null}catch{return null}}function p(i){try{if(!i)return!1;let u=(i.tagName||"").toLowerCase();if(!["button","a","div","span"].includes(u))return!1;let m=(i.getAttribute?.("aria-label")||"").toLowerCase(),_=(i.getAttribute?.("title")||"").toLowerCase(),k=(i.innerText||"").toLowerCase();return/search|find|go/.test(m+" "+_+" "+k)}catch{return!1}}document.addEventListener("keydown",i=>{if(!t())return;let u=i.target;r(u)&&i.key==="Enter"&&d(u)},!0),document.addEventListener("submit",i=>{if(!t())return;let u=i.target;if(!u||u.nodeType!==1)return;let m=Array.from(u.querySelectorAll("input,textarea")).find(r);m&&d(m)},!0),document.addEventListener("click",i=>{if(!t())return;let u=i.target?.closest?.("button,a,[role='button']");if(!u||!p(u))return;let m=f(u);m&&d(m)},!0),document.addEventListener("click",i=>{if(!t()||!/search/i.test(location.pathname+location.href))return;let u=l();if(u<=0)return;let m=i.target;if(U(m))return;let _=$(m);if(!_||U(_))return;let k=G(_),x=R(m);T(E("search_result_click",{element_id:x,query:n.lastSearchQuery,clicked_result_id:k,result_rank:K(_),results_count:u}))},!0)}function Ne(){let e=[/doubleclick\.net/i,/googlesyndication\.com/i,/adservice\.google/i,/googleadservices\.com/i,/gampad\/ads/i,/adnxs\.com/i,/criteo/i,/pubmatic\.com/i,/openx\.net/i],t=null,r=null,s=null,l=null,o=0,a=new Set,d=new WeakSet,f=new WeakSet,p=new Map;function i(){return!!c.plugins.ads}function u(h){try{let I=h?.tagName?.toLowerCase()==="iframe"?h:h?.closest?.("iframe");if(!I)return!1;let g=I.getAttribute("src")||"";return g&&e.some(S=>S.test(g))}catch{return!1}}function m(h){let g=(c.ads||{}).dataSelector||"[data-ad-id],[data-ad-slot],[data-ad-provider]";return h?.closest?.(g)||h?.closest?.("[role='advertisement']")||(h?.tagName?.toLowerCase()==="iframe"?h:h?.closest?.("iframe"))||null}function _(h){if(!h)return!1;let g=(c.ads||{}).dataSelector||"[data-ad-id],[data-ad-slot],[data-ad-provider]";return!!(h.closest?.(g)||h.closest?.("[role='advertisement']")||u(h))}function k(h){let g=(c.ads||{}).dataSelector||"[data-ad-id],[data-ad-slot],[data-ad-provider]",S=m(h);if(!S)return null;let C=S.closest?.(g)||(S.matches?.(g)?S:null),y=S.tagName?.toLowerCase()==="iframe"?S:S.querySelector?.("iframe"),H=S.closest?.("[role='advertisement']"),D=R(C||H||y||S);return D?{element_id:D,ad_id:C?.getAttribute?.("data-ad-id")||null,ad_slot:C?.getAttribute?.("data-ad-slot")||null,ad_provider:C?.getAttribute?.("data-ad-provider")||null}:null}function x(h){try{if(!t||!h||d.has(h))return;d.add(h),t.observe(h)}catch{}}function L(){if(!i())return;let I=(c.ads||{}).containerSelector||"[data-ad-id],[data-ad-slot],[data-ad-provider],[role='advertisement'],iframe";try{document.querySelectorAll(I).forEach(g=>{if(!(a.size>900)&&_(g)){if(s&&!f.has(g))try{s.observe(g),f.add(g)}catch{}j(g,40,40)&&a.add(g)}})}catch{}}function P(){if(!i()||t)return;let h=c.ads||{},I=h.threshold||.5;t=new IntersectionObserver(g=>{for(let S of g){let C=S.target;if(!_(C))continue;let y=k(C);if(!y?.element_id)continue;let H=S.intersectionRatio||0,D=S.isIntersecting&&H>=I;p.has(y.element_id)||p.set(y.element_id,{impTimer:null,impSent:!1,viewStart:null,viewableSent:!1,lastRatio:0});let b=p.get(y.element_id);if(b.lastRatio=H,D&&!b.impSent&&!b.impTimer&&(b.impTimer=setTimeout(()=>{b.impSent=!0,b.impTimer=null,T(E("ad_impression",{element_id:y.element_id,ad_id:y.ad_id,ad_slot:y.ad_slot,ad_provider:y.ad_provider}))},h.minVisibleMs||300)),!D&&b.impTimer&&(clearTimeout(b.impTimer),b.impTimer=null),D)b.viewStart===null&&(b.viewStart=N());else if(b.viewStart!==null&&!b.viewableSent){let ce=N()-b.viewStart;b.viewStart=null,ce>=(h.minViewableMs||1e3)&&(b.viewableSent=!0,T(E("ad_viewable",{element_id:y.element_id,ad_id:y.ad_id,ad_slot:y.ad_slot,ad_provider:y.ad_provider,view_time_ms:ce,viewable_percent:Math.round(b.lastRatio*100)})))}}},{threshold:[I]});try{s=new ResizeObserver(g=>{for(let S of g){let C=S.target;_(C)&&j(C,40,40)&&(a.add(C),x(C))}})}catch{s=null}L(),a.forEach(g=>x(g)),r=new MutationObserver(()=>{L(),a.forEach(g=>x(g))});try{r.observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0})}catch{}o=0,l=setInterval(()=>{o++,L(),a.forEach(g=>x(g)),o>=(h.rescanTicks||15)&&(clearInterval(l),l=null)},h.rescanIntervalMs||2e3)}function Pe(){try{r&&r.disconnect()}catch{}r=null;try{t&&t.disconnect()}catch{}t=null;try{s&&s.disconnect()}catch{}s=null,l&&(clearInterval(l),l=null),a.clear(),p.clear()}return document.addEventListener("click",h=>{if(!i())return;let I=h.target,g=I?.closest?.("a,button,[role='button'],[data-elt],iframe,[role='advertisement']")||I;if(!_(g))return;let S=k(g);S?.element_id&&T(E("ad_click",{element_id:S.element_id,ad_id:S.ad_id,ad_slot:S.ad_slot,ad_provider:S.ad_provider}))},!0),i()&&P(),{onConfigChange:()=>{i()?P():Pe()}}}let se={__meta:e=>{A={...A,...e},v("Meta set:",A)},config:e=>{e&&(e.plugins&&(c.plugins={...c.plugins,...e.plugins},delete e.plugins),e.ads!==void 0&&(c.plugins.ads=!!e.ads,delete e.ads),e.search!==void 0&&(c.plugins.search=!!e.search,delete e.search),e.search&&typeof e.search=="object"&&(c.search={...c.search,...e.search},delete e.search),e.ads&&typeof e.ads=="object"&&(c.ads={...c.ads,...e.ads},delete e.ads),c={...c,...e},v("Config set:",c),ne(),X&&X.onConfigChange?.())},consent:e=>{e&&typeof e.analytics=="boolean"&&(n.consent.analytics=e.analytics,v("Consent updated:",n.consent))},setUserId:e=>{Se(e)},event:e=>{if(!e||!e.type){v("Invalid event format, expected {type, payload}");return}let t=e.type,r=e.payload||{};T(E(t,r))},flush:()=>{B({reason:"manual"})}};function Oe(){let e=window[Z]||[];e.forEach(t=>{if(Array.isArray(t)&&t.length>=1){let[r,...s]=t,l=se[r];l?l(...s):v("Unknown command:",r)}}),e.push=function(t){if(Array.prototype.push.call(this,t),Array.isArray(t)&&t.length>=1){let[r,...s]=t,l=se[r];l&&l(...s)}}}let X=null;function oe(){if(n.anonymous_id=he(),n.session_id=ge(),pe(),n.entryReferrer=_e(),n.currentUrl=M(),n.previousUrl=null,Oe(),!A.project_id||!c.collectUrl){console.error("[PrimeTracker] Missing project_id or collectUrl");return}ne(),xe(),c.trackClicks&&document.addEventListener("click",Te,!0),c.trackScroll&&window.addEventListener("scroll",Ie,{passive:!0}),document.addEventListener("visibilitychange",Le),window.addEventListener("pagehide",ae,{capture:!0}),window.addEventListener("beforeunload",ae,{capture:!0}),Ae(),Ce(),c.trackCards&&(Me(),Re()),c.plugins.search&&Ue(),c.plugins.ads&&(X=Ne()),c.trackPageViews&&ie("initial"),window[Z].trackRoute=q,v("SDK initialized",{project_id:A.project_id,collectUrl:c.collectUrl,consent:n.consent.analytics,sampled:n.sampled,plugins:c.plugins,trackCards:c.trackCards})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",oe):oe()})();})();
